%%
%% This is file `beamerinnerthemelancaster.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% beamerinnerthemelancaster.dtx  (with options: `package')
%% ---------------------------------------------------------------------------
%% Copyright 2015 Matthias Vogelgesang and the LaTeX community. A full list of
%% contributors can be found at
%% 
%%     https://github.com/matze/mtheme/graphs/contributors
%% 
%% and the original template was based on the HSRM theme by Benjamin Weiss.
%% 
%% This work is licensed under a Creative Commons Attribution-ShareAlike 4.0
%% International License (https://creativecommons.org/licenses/by-sa/4.0/).
%% ---------------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerinnerthemelancaster}[2017/01/23 Lancaster inner theme]
\RequirePackage{etoolbox}
\RequirePackage{keyval}
\RequirePackage{calc}
\RequirePackage{pgfopts}
\RequirePackage{tikz}
\pgfkeys{
  /lancaster/inner/sectionpage/.cd,
    .is choice,
    none/.code=\lancaster@disablesectionpage,
    simple/.code={\lancaster@enablesectionpage
                  \setbeamertemplate{section page}[simple]},
    progressbar/.code={\lancaster@enablesectionpage
                       \setbeamertemplate{section page}[progressbar]},
}
\pgfkeys{
  /lancaster/inner/subsectionpage/.cd,
    .is choice,
    none/.code=\lancaster@disablesubsectionpage,
    simple/.code={\lancaster@enablesubsectionpage
                  \setbeamertemplate{section page}[simple]},
    progressbar/.code={\lancaster@enablesubsectionpage
                       \setbeamertemplate{section page}[progressbar]},
}

\newcommand{\lancaster@inner@logodept}{
  \def\logoindent{10.35}
  \def\insertLUlogo{img/dept-logo.png}
}

\newcommand{\lancaster@inner@logouni}{
  \def\logoindent{6.35}
  \def\insertLUlogo{img/lu-logo.png}
}


\newcommand{\lancaster@inner@whitelogo}{
%  \def\insertLUlogo{img/logoWhite}
}
\newcommand{\lancaster@inner@standardlogo}{
  %  \def\insertLUlogo{img/logoNormal}
}

\newcommand{\lancaster@inner@setdefaults}{
  \pgfkeys{/lancaster/inner/.cd,
    sectionpage=progressbar,
    subsectionpage=none
  }
}
\setbeamertemplate{title page}{
  \begin{minipage}[b][\paperheight]{\textwidth}
    \ifx\inserttitlegraphic\@empty\else\usebeamertemplate*{title graphic}\fi
    \vfill%
    \ifx\inserttitle\@empty\else\usebeamertemplate*{title}\fi
    \ifx\insertsubtitle\@empty\else\usebeamertemplate*{subtitle}\fi
    \usebeamertemplate*{title separator}
    \ifx\beamer@shortauthor\@empty\else\usebeamertemplate*{author}\fi
    \ifx\insertdate\@empty\else\usebeamertemplate*{date}\fi
    \ifx\insertinstitute\@empty\else\usebeamertemplate*{institute}\fi
    \vfill
    \vspace*{1mm}
  \end{minipage}
}
\setbeamerfont{normal text}{size=\LARGE}

% TODO Convert all units to cm.
% An em is a typographic unit, the width of a lowercase letter "m". By definition, it is equivalent to the height of the font (for example, in 16 point type en is 16 points). The em dash (—) and em space ( ) are each one em wide.


\setbeamertemplate{title page}{
  \usebeamercolor{titlebackground}
  \nointerlineskip%
  \begin{tikzpicture}[remember picture, overlay, shift=(current page.south west)]
    \fill [fill=bg] (0.265cm,0.265cm) rectangle (\paperwidth-0.265cm,\paperheight-0.265cm);
    \node[inner sep=0pt] (logo) at (\paperwidth-\logoindent em, \paperheight-3.7em)
         {\includegraphics[height=2.7em]{\insertLUlogo}};
  \end{tikzpicture}    

  \vspace{0.0\paperheight}
  \begin{beamercolorbox}[%
      wd=0.8\paperwidth,%
      sep=0pt,%
      leftskip=\lancaster@frametitle@padding,%
      rightskip=\lancaster@frametitle@padding,%
      %ht=3.5em
      ht=0.567\paperheight
      %ht = 4.5em
    ]{title page}%
    %\lancaster@frametitlestrut@start%
    %\vspace{2em}
    % Using vbox as suggested to ensure that single or double line of text
    % is centred at same point (vertically aligned)
    % suggest at
    % https://tex.stackexchange.com/questions/56300/how-can-i-vertically-align-a-beamercolorbox
    %
%    \vbox to 4em{\vfill
      \raggedright
      \ifx\inserttitle\@empty\else\usebeamertemplate*{title}\fi
      \ifx\insertsubtitle\@empty\else\usebeamertemplate*{subtitle}\fi
      \vspace{1.2em}
%      \vfill}
  \end{beamercolorbox}%
    \vspace{-2em}
  \noindent\textcolor{lancasterGrey}{\rule{6.5em}{0.08em}}
%  \setbeamercolor{title page}{bg=lancasterRed!10} % for debugging
  \begin{beamercolorbox}[%
      wd=0.8\paperwidth,%
      sep=0pt,%
      leftskip=\lancaster@frametitle@padding,%
      rightskip=\lancaster@frametitle@padding,%
      ht=0.415\paperheight,
    ]{title page}%
    %\lancaster@frametitlestrut@start%
    %\vspace{2em}
    % Using vbox as suggested to ensure that single or double line of text
    % is centred at same point (vertically aligned)
    % suggest at
    % https://tex.stackexchange.com/questions/56300/how-can-i-vertically-align-a-beamercolorbox
    %
    \vbox to 0.415\paperheight{%\vfill
      \vspace{1.1em}     
      \raggedright
    \ifx\insertdate\@empty\else\usebeamertemplate*{date}\fi
    \ifx\beamer@shortauthor\@empty\else\usebeamertemplate*{author}\fi
    \ifx\insertinstitute\@empty\else\usebeamertemplate*{institute}\fi
    \vfill
}
%    \vspace{0.13\paperheight}
  \end{beamercolorbox}%
}


\def\maketitle{%
  \ifbeamer@inframe
    \titlepage
  \else
    \frame[plain,noframenumbering]{\titlepage}
  \fi
}
\def\titlepage{%
  \usebeamertemplate{title page}
}
\setbeamertemplate{title graphic}{
  \vbox to 0pt {
    \vspace*{2em}
    \inserttitlegraphic \\ %
  }%
  \nointerlineskip%
}
\setbeamertemplate{title}{
  \raggedright%
  \linespread{1.0}%
  \inserttitle%
  \par
  \nointerlineskip%
  \vspace*{0.5em}
}
\setbeamertemplate{subtitle}{
  \raggedright%
  \insertsubtitle%
  \par%
  \vspace*{0.5em}
}
\newlength{\lancaster@titleseparator@linewidth}
\setlength{\lancaster@titleseparator@linewidth}{0.4pt}
\setbeamertemplate{title separator}{
  \tikzexternaldisable%
  \begin{tikzpicture}
    \fill[fg] (0,0) rectangle (\textwidth, \lancaster@titleseparator@linewidth);
  \end{tikzpicture}%
  \tikzexternalenable%
  \par%
}
\setbeamertemplate{author}{
  \vspace*{0.25em}
  \insertauthor%
  \par%
%  \vspace*{0.25em}
}
\setbeamertemplate{date}{
  \insertdate%
  \par%
}
\setbeamertemplate{institute}{
  \vspace*{0.25em}
  \insertinstitute%
  \par%
}
\defbeamertemplate{section page}{simple}{
  \begin{center}
    \usebeamercolor[fg]{section title}
    \usebeamerfont{section title}
    \insertsectionhead\par
    \ifx\insertsubsectionhead\@empty\else
      \usebeamercolor[fg]{subsection title}
      \usebeamerfont{subsection title}
      \insertsubsectionhead
    \fi
  \end{center}
}
\defbeamertemplate{section page}{progressbar}{
    \nointerlineskip%
  \vspace{0.05\paperheight}
%  \setbeamercolor{title page}{bg=lancasterGrey!20} %for debuigging
  \begin{beamercolorbox}[%
      wd=0.8\paperwidth,%
      sep=0pt,%
      leftskip=\lancaster@frametitle@padding,%
      rightskip=\lancaster@frametitle@padding,%
      %ht=3.5em
      ht=0.54\paperheight
      %ht = 4.5em
    ]{title page}%
    %\lancaster@frametitlestrut@start%
    %\vspace{2em}
    % Using vbox as suggested to ensure that single or double line of text
    % is centred at same point (vertically aligned)
    % suggest at
    % https://tex.stackexchange.com/questions/56300/how-can-i-vertically-align-a-beamercolorbox
    %
%    \vbox to 4em{\vfill
    \raggedright
  \raggedright%
  \linespread{1.0}%
  \usebeamerfont{title}\color{lancasterRed}\insertsectionhead
    \par
  \nointerlineskip%
  \vspace*{0.5em}

      \vspace{0.5em}
%      \vfill}
  \end{beamercolorbox}%
    \vspace{-2em}
  \noindent\textcolor{lancasterGrey}{\rule{6.5em}{0.08em}}
\vspace{0.425\paperheight}
  %
%  \centering
%  \begin{minipage}{22em}
%    \raggedright
%    \usebeamercolor[fg]{section title}
%    \usebeamerfont{section title}
%    \insertsectionhead\\[-1ex]
%    \usebeamertemplate*{progress bar in section page}
%    \par
%    \ifx\insertsubsectionhead\@empty\else%
%      \usebeamercolor[fg]{subsection title}%
%      \usebeamerfont{subsection title}%
%      \insertsubsectionhead
%    \fi
%  \end{minipage}
%  \par
%  \vspace{\baselineskip}
}
\newcommand{\lancaster@disablesectionpage}{
  \AtBeginSection{
    % intentionally empty
  }
}
\newcommand{\lancaster@enablesectionpage}{
  \AtBeginSection{
    \ifbeamer@inframe
      \sectionpage
    \else
      \frame[plain,c,noframenumbering]{\sectionpage}
    \fi
  }
}
\setbeamertemplate{subsection page}{%
  \usebeamertemplate*{section page}
}
\newcommand{\lancaster@disablesubsectionpage}{
  \AtBeginSubsection{
    % intentionally empty
  }
}
\newcommand{\lancaster@enablesubsectionpage}{
  \AtBeginSubsection{
    \ifbeamer@inframe
      \subsectionpage
    \else
      \frame[plain,c,noframenumbering]{\subsectionpage}
    \fi
  }
}
\newlength{\lancaster@progressonsectionpage}
\newlength{\lancaster@progressonsectionpage@linewidth}
\setlength{\lancaster@progressonsectionpage@linewidth}{0.4pt}
\setbeamertemplate{progress bar in section page}{
  \setlength{\lancaster@progressonsectionpage}{%
    \textwidth * \ratio{\insertframenumber pt}{\inserttotalframenumber pt}%
  }%
  \tikzexternaldisable%
  \begin{tikzpicture}
    \fill[bg] (0,0) rectangle (\textwidth, \lancaster@progressonsectionpage@linewidth);
    \fill[fg] (0,0) rectangle (\lancaster@progressonsectionpage, \lancaster@progressonsectionpage@linewidth);
  \end{tikzpicture}%
  \tikzexternalenable%
}
\def\inserttotalframenumber{100}
\newlength{\lancaster@blocksep}
\newlength{\lancaster@blockadjust}
\setlength{\lancaster@blocksep}{0.75ex}
\setlength{\lancaster@blockadjust}{0.25ex}
\providecommand{\lancaster@strut}{%
  \vphantom{ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz()}%
}
\newcommand{\lancaster@block}[1]{
  \par\vskip\medskipamount%
  \setlength{\parskip}{0pt}
  \ifbeamercolorempty[bg]{block title#1}{%
    \begin{beamercolorbox}[rightskip=0pt plus 4em]{block title#1}}{%
  \ifbeamercolorempty[bg]{block title}{%
    \begin{beamercolorbox}[rightskip=0pt plus 4em]{block title#1}%
  }%
  {%
    \begin{beamercolorbox}[
      sep=\dimexpr\lancaster@blocksep-\lancaster@blockadjust\relax,
      leftskip=\lancaster@blockadjust,
      rightskip=\dimexpr\lancaster@blockadjust plus 4em\relax
    ]{block title#1}%
  }}%
      \usebeamerfont*{block title#1}%
      \lancaster@strut%
      \insertblocktitle%
      \lancaster@strut%
  \end{beamercolorbox}%
  \nointerlineskip%
  \ifbeamercolorempty[bg]{block body#1}{%
    \begin{beamercolorbox}[vmode]{block body#1}}{
  \ifbeamercolorempty[bg]{block body}{%
    \begin{beamercolorbox}[vmode]{block body#1}%
  }{%
    \begin{beamercolorbox}[sep=\lancaster@blocksep, vmode]{block body#1}%
    \vspace{-\lancaster@parskip}
  }}%
      \usebeamerfont{block body#1}%
      \setlength{\parskip}{\lancaster@parskip}%
}
\setbeamertemplate{block begin}{\lancaster@block{}}
\setbeamertemplate{block alerted begin}{\lancaster@block{ alerted}}
\setbeamertemplate{block example begin}{\lancaster@block{ example}}
\setbeamertemplate{block end}{\end{beamercolorbox}\vspace*{0.2ex}}
\setbeamertemplate{block alerted end}{\end{beamercolorbox}\vspace*{0.2ex}}
\setbeamertemplate{block example end}{\end{beamercolorbox}\vspace*{0.2ex}}

%Specify itemize spacing
\let\olditem\item
\renewcommand{\item}{%
  \olditem\vspace{0.17em}
}

\setbeamertemplate{itemize items}{\color{lancasterGrey}\textbullet}
%\setbeamertemplate{itemize items}{\color{lancasterGrey}{\fontsize{15}{15}\selectfont\textbullet}}
%\setbeamertemplate{itemize subitem}{\color{lancasterGrey}{\fontsize{13}{13}\selectfont\textbullet}}
%\setbeamertemplate{itemize subsubitem}{\color{lancasterGrey}{\fontsize{11}{11}\selectfont\textbullet}}
\setbeamertemplate{caption label separator}{: }
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{footnote}{%
  \parindent 0em\noindent%
  \raggedright
  \usebeamercolor{footnote}\hbox to 0.8em{\hfil\insertfootnotemark}\insertfootnotetext\par%
}
\newlength{\lancaster@parskip}
\setlength{\lancaster@parskip}{0.5em}
\setlength{\parskip}{\lancaster@parskip}
\linespread{1.15}
\define@key{beamerframe}{c}[true]{% centered
  \beamer@frametopskip=0pt plus 1fill\relax%
  \beamer@framebottomskip=0pt plus 1fill\relax%
  \beamer@frametopskipautobreak=0pt plus .4\paperheight\relax%
  \beamer@framebottomskipautobreak=0pt plus .6\paperheight\relax%
  \def\beamer@initfirstlineunskip{}%
}
\providebool{lancaster@standout}
\define@key{beamerframe}{standout}[true]{%
  \booltrue{lancaster@standout}
  \begingroup
    \setkeys{beamerframe}{c}
    \setkeys{beamerframe}{noframenumbering}
    \ifbeamercolorempty[bg]{palette primary}{
      \setbeamercolor{background canvas}{
        use=palette primary,
        bg=-palette primary.fg
      }
    }{
      \setbeamercolor{background canvas}{
        use=palette primary,
        bg=palette primary.bg
      }
    }
    \setbeamercolor{local structure}{
      fg=palette primary.fg
    }
    \usebeamercolor[fg]{palette primary}
}
  \pretocmd{\beamer@reseteecodes}{%
    \ifbool{lancaster@standout}{
      \endgroup
      \boolfalse{lancaster@standout}
    }{}
  }{}{}
  \AtBeginEnvironment{beamer@frameslide}{
    \ifbool{lancaster@standout}{
      \centering
      \usebeamerfont{standout}
    }{}
  }
%\lancaster@inner@setdefaults
\ProcessPgfPackageOptions{/lancaster/inner}
\endinput
%%
%% End of file `beamerinnerthemelancaster.sty'.
