%%
%% This is file `beamerouterthemelancaster.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% beamerouterthemelancaster.dtx  (with options: `package')
%% ---------------------------------------------------------------------------
%% Copyright 2015 Matthias Vogelgesang and the LaTeX community. A full list of
%% contributors can be found at
%% 
%%     https://github.com/matze/mtheme/graphs/contributors
%% 
%% and the original template was based on the HSRM theme by Benjamin Weiss.
%% 
%% This work is licensed under a Creative Commons Attribution-ShareAlike 4.0
%% International License (https://creativecommons.org/licenses/by-sa/4.0/).
%% ---------------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerouterthemelancaster}[2017/01/23 Lancaster outer theme]
\RequirePackage{etoolbox}
\RequirePackage{calc}
\RequirePackage{pgfopts}
\pgfkeys{
  /lancaster/outer/numbering/.cd,
    .is choice,
    none/.code=\setbeamertemplate{frame numbering}[none],
    counter/.code=\setbeamertemplate{frame numbering}[counter],
    fraction/.code=\setbeamertemplate{frame numbering}[fraction],
}
\pgfkeys{
  /lancaster/outer/progressbar/.cd,
    .is choice,
    none/.code={%
      \setbeamertemplate{headline}[plain]
      \setbeamertemplate{frametitle}[plain]
      \setbeamertemplate{footline}[plain]
    },
    head/.code={\pgfkeys{/lancaster/outer/progressbar=none}
      \addtobeamertemplate{headline}{}{%
        \usebeamertemplate*{progress bar in head/foot}
      }
    },
    frametitle/.code={\pgfkeys{/lancaster/outer/progressbar=none}
      \addtobeamertemplate{frametitle}{}{%
        \usebeamertemplate*{progress bar in head/foot}
      }
    },
    foot/.code={\pgfkeys{/lancaster/outer/progressbar=none}
      \addtobeamertemplate{footline}{}{%
        \usebeamertemplate*{progress bar in head/foot}%
      }
    },
}

\newcommand{\lancaster@outer@logodept}{
  \def\logoframeindent{12.96}
  \def\insertLUlogo{img/dept-logo.png}
}

\newcommand{\lancaster@outer@logouni}{
  \def\logoframeindent{10.96}
  \def\insertLUlogo{img/lu-logo.png}
}

\newcommand{\lancaster@outer@setdefaults}{
  \pgfkeys{/lancaster/outer/.cd,
    numbering=counter,
    progressbar=none,
  }
}
\setbeamertemplate{navigation symbols}{}
\defbeamertemplate{frame footer}{none}{}
\defbeamertemplate{frame footer}{custom}[1]{ #1 }
\defbeamertemplate{frame numbering}{none}{}
\defbeamertemplate{frame numbering}{counter}{\insertframenumber}
\defbeamertemplate{frame numbering}{fraction}{
  \insertframenumber/\inserttotalframenumber
}
\defbeamertemplate{headline}{plain}{}
\defbeamertemplate{footline}{plain}{%
  \begin{beamercolorbox}[wd=0.98\textwidth, sep=4ex]{footline}%
    \usebeamerfont{page number in head/foot}%
    \usebeamertemplate*{frame footer}
    \hfill%
    \usebeamertemplate*{frame numbering}
  \end{beamercolorbox}%
}
\newlength{\lancaster@frametitle@padding}
\setlength{\lancaster@frametitle@padding}{0em}
%\setlength{\lancaster@frametitle@padding}{0.5ex}
\newcommand{\lancaster@frametitlestrut@start}{
  \rule{0pt}{\lancaster@frametitle@padding +%
    \totalheightof{%
      \ifcsdef{lancaster@frametitleformat}{\lancaster@frametitleformat X}{X}%
    }%
  }%
}
\newcommand{\lancaster@frametitlestrut@end}{
  \rule[-\lancaster@frametitle@padding]{0pt}{\lancaster@frametitle@padding}
}
\defbeamertemplate{frametitle}{plain}{%
  \nointerlineskip%
  \begin{beamercolorbox}[%
      wd=0.5\paperwidth,%
      sep=0pt,%
      leftskip=\lancaster@frametitle@padding,%
      rightskip=\lancaster@frametitle@padding,%
      ht=5.1em 
    ]{frametitle}%
    % \lancaster@frametitlestrut@start%
    %\vspace{2em}
    % Using vbox as suggested to ensure that single or double line of text
    % is centred at same point (vertically aligned)
    % suggest at
    % https://tex.stackexchange.com/questions/56300/how-can-i-vertically-align-a-beamercolorbox
    %
    \vbox to3em{\vfill
      \raggedright
      \usebeamerfont{frametitle}\insertframetitle
      
      \usebeamerfont{framesubtitle}\insertframesubtitle
      \vfill}
  \nolinebreak%
    \par
    \vspace{-1.0em}
    {\hspace{-0.3em}\noindent\textcolor{lancasterGrey}{\rule{4.2em}{0.06em}}}
    \vspace{0.1em}
    %\lancaster@frametitlestrut@end%
%    \includegraphics[height=2em]{img/logo}
    \begin{tikzpicture}[remember picture, overlay]
      \node[inner sep=0pt] (russell) at (\paperwidth-\logoframeindent em, 2.1em)
           {\includegraphics[height=1.7em]{\insertLUlogo}};
    \end{tikzpicture}    

  \end{beamercolorbox}%
}
\setbeamertemplate{frametitle continuation}{%
  \usebeamerfont{frametitle}
  \romannumeral \insertcontinuationcount
}

\defbeamertemplate*{background}{lancaster}[1][]{
  \begin{tikzpicture}[remember picture, overlay]
    \draw [line width=0.53cm,lancasterLightGrey] (current page.south east) rectangle (current page.north west);
%    \node[inner sep=0pt] (russell) at (\paperwidth-6.4em, -3.97em)
%        {\includegraphics[height=2.3em]{img/logoNormal}};
  \end{tikzpicture}    
}


\newlength{\lancaster@progressinheadfoot}
\newlength{\lancaster@progressinheadfoot@linewidth}
\setlength{\lancaster@progressinheadfoot@linewidth}{0.4pt}
\setbeamertemplate{progress bar in head/foot}{
  \nointerlineskip
  \setlength{\lancaster@progressinheadfoot}{%
    \paperwidth * \ratio{\insertframenumber pt}{\inserttotalframenumber pt}%
  }%
  \begin{beamercolorbox}[wd=\paperwidth]{progress bar in head/foot}
    \tikzexternaldisable%
    \begin{tikzpicture}
      \fill[bg] (0,0) rectangle (\paperwidth, \lancaster@progressinheadfoot@linewidth);
      \fill[fg] (0,0) rectangle (\lancaster@progressinheadfoot, \lancaster@progressinheadfoot@linewidth);
    \end{tikzpicture}%
    \tikzexternalenable%
  \end{beamercolorbox}
}
\AtBeginDocument{%
  \apptocmd{\appendix}{%
    \pgfkeys{%
      /lancaster/outer/.cd,
      numbering=none,
      progressbar=none}
    }{}{}
}
\lancaster@outer@setdefaults
\ProcessPgfPackageOptions{/lancaster/outer}
\endinput
%%
%% End of file `beamerouterthemelancaster.sty'.
